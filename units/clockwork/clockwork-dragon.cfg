[unit_type]
    id=Clockwork Dragon
    name= _ "Clockwork Dragon"
    race=clockwork
    image="units/clockwork/clockwork_dragon.png"

    hitpoints=112
    movement_type=clockworkfoot
    movement=6
    level=4
    alignment=neutral
    cost=76
    usage=fighter
    experience=300
	advances_to=
    description= _ ""
    {DEFENSE_ANIM "units/clockwork/clockwork_dragon.png" "units/clockwork/clockwork_dragon.png" {SOUND_LIST:GRYPHON_HIT} }
    die_sound={SOUND_LIST:GRYPHON_DIE}

    [resistance]
        arcane=90
		impact=130
		fire=20
    [/resistance]
	
	[attack]
        name=beak
        description=_"beak"
        icon=attacks/rayblade.png
        type=blade
        range=melee
        damage=14
        number=4
    [/attack]
	
    [attack]
        name=fire breath
        description=_"fire breath"
        icon=attacks/dragonstaff.png
        type=fire
        range=ranged
        damage=12
        number=3
		[specials]
			[line_damage]
				id=line_damage
				name="line damage"
				description="This unit deals half damage to the unit that is standing behind the attacked unit."
			[/line_damage]
		[/specials]
    [/attack]
	

    [attack_anim]
        [filter_attack]
            name=fire breath
        [/filter_attack]
		
        start_time=-1000
		missile_start_time=-800
		
		offset=0
        [frame]
            image="units/clockwork/clockwork_dragon.png"
        [/frame]
        {SOUND:HIT_AND_MISS fire.wav fire.wav -50}

			
	        flame_burst_1_start_time=-800
			flame_burst_2_start_time=-400
			flame_burst_3_start_time=-0


			[flame_burst_1_frame]
				halo="projectiles/fireball-impact-[1~16].png~SCALE(200,200):70"
				offset=0.8
				auto_vflip=false
			[/flame_burst_1_frame]
			[flame_burst_2_frame]
				halo="projectiles/fireball-impact-[1~16].png~SCALE(200,200):70"
				offset=1.1
				auto_vflip=false
			[/flame_burst_2_frame]
			[flame_burst_3_frame]
				halo="projectiles/fireball-impact-[1~16].png~SCALE(200,200):70"
				offset=1.5
				auto_vflip=false
			[/flame_burst_3_frame]
        [frame]
            image="units/clockwork/clockwork_dragon.png:65"
        [/frame]
    [/attack_anim]
	
    [attack_anim]
        [filter_attack]
            name=beak
        [/filter_attack]
		
		offset=0.0~-0.3,-0.3~0.5,0.5~0.6,0.6~0.7,0.7~0.6,0.6~0.3,0.3~0.0
		start_time=-330
		[frame]
			image="units/clockwork/clockwork_dragon.png:[120*6]"
		[/frame]
		
		[if]
			hits=yes
			
	        flame_burst_1_start_time=0
			flame_burst_2_start_time=140
			flame_burst_3_start_time=280
			flame_burst_4_start_time=420
			flame_burst_5_start_time=560
			flame_burst_6_start_time=680


			[flame_burst_1_frame]
				halo=strikegfx/pierce-[1~5].png:[60*5]
				halo_x=+10
				halo_y=-5
				offset=1
				auto_vflip=false
			[/flame_burst_1_frame]
			[flame_burst_2_frame]
				halo=strikegfx/pierce-[1~5].png:[60*5]
				halo_x=0
				halo_y=2
				offset=1
				auto_vflip=false
			[/flame_burst_2_frame]
			[flame_burst_3_frame]
				halo=strikegfx/pierce-[1~5].png:[60*5]
				halo_x=+4
				halo_y=+6
				offset=1
				auto_vflip=false
			[/flame_burst_3_frame]
			[flame_burst_4_frame]
				halo=strikegfx/pierce-[1~5].png:[60*5]
				halo_x=-7
				halo_y=0
				offset=1
				auto_vflip=false
			[/flame_burst_4_frame]
			[flame_burst_5_frame]
				halo=strikegfx/pierce-[1~5].png:[60*5]
				halo_x=-11
				halo_y=-11
				offset=1
				auto_vflip=false
			[/flame_burst_5_frame]
			[flame_burst_6_frame]
				halo=strikegfx/pierce-[1~5].png:[60*5]
				halo_x=5
				halo_y=5
				offset=1
				auto_vflip=false
			[/flame_burst_6_frame]
		[/if]

        {SOUND:HIT_AND_MISS spear.ogg spear-miss.ogg -100}
    [/attack_anim]
	
	

	[event]
		name=attacker_hits
		first_time_only=no
		
		[filter]
			type=Clockwork Dragon
		[/filter]
		
		[filter_attack]
			name=fire breath
		[/filter_attack]
		
		[store_locations]
			[filter_adjacent_location]
				x,y=$x2,$y2
				adjacent=$second_unit.facing
			[/filter_adjacent_location]
			variable=next_target
		[/store_locations]
		
		[harm_unit]
			[filter]
				x,y=$next_target[0].x,$next_target[0].y
				[not]
					[filter_wml]
						[status]
							petrified=yes
						[/status]
					[/filter_wml]
				[/not]
			[/filter]
			[filter_second]
				x,y=$x1,$y1
			[/filter_second]
			amount=6
			alignment=$unit.alignment
			damage_type=fire
			fire_event=yes
			animate=no
			experience=yes
			kill=yes
			delay=0
		[/harm_unit]
	[/event]

[/unit_type]
