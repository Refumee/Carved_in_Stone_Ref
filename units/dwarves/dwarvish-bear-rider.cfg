[unit_type]
    id=Bear Rider
    name= _ "Bear Rider"
    race=dwarf
    image="units/dwarves/bear_rider.png"
    profile="portraits/dwarves/ulfserker.webp"

    hitpoints=48
    movement_type=dwarvishfoot
    movement=6
    level=1
    alignment=neutral
    cost=25
    usage=fighter
    experience=45
	advances_to=Bear Cavalry, Iron Bear
    description= _ "The bears of the valleys of the Heart Mountains are one of the fiercest yet tameable creatures of the Northlands. As both dwarves and bears inhabit these mountains, it was just a matter of time the dwarves managed to tame them. The Shorbear Clan was the first one to do so."
    {DEFENSE_ANIM "units/dwarves/bear_rider.png" "units/dwarves/bear_rider.png" {SOUND_LIST:DWARF_HIT} }
    die_sound={SOUND_LIST:DWARF_DIE}
	[movement_costs]
        frozen=1
    [/movement_costs]
    [defense]
		frozen=30
        flat=60
        forest=60
        sand=60
        mountains=40
        hills=50
    [/defense]
    [resistance]
        blade=70
        pierce=70
    [/resistance]
    [attack]
        name=ram
        description=_"ram"
        icon=attacks/ram.png
        type=impact
        range=melee
        damage=14
        number=1
			[specials]
				{WEAPON_SPECIAL_KNOCKBACK}
			[/specials]
    [/attack]
    [attack]
        name=hammer
        description=_"hammer"
        icon=attacks/hammer-dwarven.png
        type=impact
        range=melee
        damage=8
        number=3

    [/attack]
    [attack]
        name=bite
        description=_"bite"
        icon=attacks/fangs-animal.png
        type=blade
        range=melee
        damage=6
        number=4
    [/attack]
	
    [attack_anim]
        [filter_attack]
            name=hammer
        [/filter_attack]
        start_time=-500

        [frame]
            image="units/dwarves/bear_rider.png:50"
            offset=0.0~-0.1
        [/frame]
        [frame]
            image="units/dwarves/bear_rider.png:500"
            offset=-0.1~-0.2.0:200,-0.2~0.0:150,0.0~0.6:100,0.6~0.4:100
        [/frame]
        [frame]
            image="units/dwarves/bear_rider.png:100"
            offset=0.4~0.0
        [/frame]

        {SOUND:HIT_AND_MISS mace.ogg {SOUND_LIST:MISS} -100}
    [/attack_anim]
	
    [attack_anim]
        [filter_attack]
            name=ram
        [/filter_attack]
        start_time=-2050

        [frame]
            image="units/dwarves/bear_rider.png:600"
            offset=0.0~-0.3:400,-0.3~-0.3:200
        [/frame]
        [frame]
            image="units/dwarves/bear_rider.png:1050"
            offset=-0.3~-0.2.0:200,-0.2~0.0:150,0.0~1.0:400,1.0~0.9:200
			halo=halo/trample-[1,2,3,4,5,1,2,3,4,5].png~SCALE(120,120)~O(60%):55
        [/frame]
        [frame]
            image="units/dwarves/bear_rider.png:400"
            offset=0.9~0.0:400
        [/frame]

        {SOUND:HIT_AND_MISS yeti-hit.ogg {SOUND_LIST:MISS} -100}
    [/attack_anim]


 [event]
       name=attack end
       first_time_only=no
   
       [filter_attack]
           special=BEAR_RIDER_knockback
       [/filter_attack]
   
       [filter_second]
           [not]
				ability=steadfast
               [filter_location]
                   terrain=*^V*
               [/filter_location]
           [/not]
       [/filter_second]
   
       [if]
           [variable]
               name=second_unit.hitpoints
               greater_than=0
           [/variable]
			
			[then]
               [store_locations]
                   [not]
                       [filter]
                       [/filter]
                   [/not]
   
                   [filter_adjacent_location]
                       x,y=$x2,$y2
                       adjacent=-$unit.facing
                   [/filter_adjacent_location]
   
                   variable=knockback_target_hex
               [/store_locations]
   
               [if]
                   [variable]
                       name=knockback_target_hex.length
                       greater_than=0
                   [/variable]
   
                   [then]
						[if]
							[have_location]
								x,y=$knockback_target_hex.x,$knockback_target_hex.y
								terrain=!,Q*,X*
								[not]
									[filter]
									[/filter]
								[/not]
							[/have_location]
							[then]
								[sound]
									name=mace.ogg
								[/sound]
								
								[move_unit]
									x,y=$x2,$y2
									to_x,to_y=$knockback_target_hex.x,$knockback_target_hex.y
								   check_passability=no
								[/move_unit]
							[/then]
						[/if]
   
                       [if]
                           [have_unit]
                               x,y=$knockback_target_hex.x,$knockback_target_hex.y
                           [/have_unit]
   
                           [then]
							   
							    [store_unit]
                                   [filter]
                                       x,y=$knockback_target_hex.x,$knockback_target_hex.y
                                   [/filter]
   
                                   kill=yes
                                   variable=knockbacked
                               [/store_unit]
   
                               [unstore_unit]
                                   variable=knockbacked
                                   text= _ "Knockback!"
                                   {COLOR_HARM}
                               [/unstore_unit]
   
                               {CLEAR_VARIABLE knockbacked}
                           [/then]
                       [/if]
                   [/then]
               [/if]
   
               {CLEAR_VARIABLE knockback_direction,knockback_target_hex}
           [/then]
       [/if]
   [/event]
[/unit_type]
